<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ê—Ä—Ö–∏–≤ —Å–µ–º—å–∏ –ö—É–∏—Å</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            min-height: -webkit-fill-available;
            overscroll-behavior: none;
        }
        
        html {
            height: -webkit-fill-available;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .media-card {
            transition: all 0.3s ease;
        }
        
        @media (hover: hover) {
            .media-card:hover {
                transform: translateY(-8px) scale(1.02);
                box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4);
            }
            
            .media-card:hover .overlay {
                opacity: 1;
            }
            
            .media-card:hover img,
            .media-card:hover video {
                transform: scale(1.1);
            }
        }
        
        /* Touch devices - always show overlay */
        @media (hover: none) {
            .media-card .overlay {
                opacity: 1;
                background: linear-gradient(to top, rgba(0,0,0,0.7) 0%, transparent 60%);
            }
            
            .media-card:active {
                transform: scale(0.98);
            }
        }
        
        .overlay {
            opacity: 0;
            transition: opacity 0.3s ease;
            background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, transparent 100%);
        }
        
        .modal {
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(30px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideUpModal {
            from { 
                opacity: 0;
                transform: translateY(100%);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .animate-slide-up {
            animation: slideUp 0.5s ease forwards;
        }
        
        .animate-slide-up-modal {
            animation: slideUpModal 0.3s ease forwards;
        }
        
        .filter-btn.active {
            background: linear-gradient(135deg, #e94560, #ff6b6b);
            color: white;
        }
        
        .date-badge {
            background: linear-gradient(135deg, #e94560, #ff6b6b);
        }
        
        .video-indicator {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
        }
        
        ::-webkit-scrollbar {
            width: 4px;
            height: 4px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
        }
        
        .timeline-line {
            background: linear-gradient(to bottom, #e94560, #4facfe, #00f2fe);
        }
        
        .upload-zone {
            border: 2px dashed rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }
        
        .upload-zone:hover, .upload-zone.dragover {
            border-color: #e94560;
            background: rgba(233, 69, 96, 0.1);
        }
        
        /* Mobile bottom sheet modal */
        @media (max-width: 640px) {
            .mobile-sheet {
                border-radius: 24px 24px 0 0;
                max-height: 90vh;
                overflow-y: auto;
            }
            
            .mobile-sheet::before {
                content: '';
                display: block;
                width: 40px;
                height: 4px;
                background: rgba(255,255,255,0.3);
                border-radius: 2px;
                margin: 0 auto 16px;
            }
        }
        
        /* Filter scroll on mobile */
        .filter-scroll {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .filter-scroll::-webkit-scrollbar {
            display: none;
        }
        
        /* Safe area for notched phones */
        .safe-bottom {
            padding-bottom: env(safe-area-inset-bottom, 20px);
        }
        
        .safe-top {
            padding-top: env(safe-area-inset-top, 0px);
        }
        
        /* Touch-friendly buttons */
        .touch-btn {
            min-width: 44px;
            min-height: 44px;
        }
        
        /* Swipe indicator */
        .swipe-hint {
            animation: swipeHint 2s ease-in-out infinite;
        }
        
        @keyframes swipeHint {
            0%, 100% { transform: translateX(0); opacity: 0.5; }
            50% { transform: translateX(-10px); opacity: 1; }
        }
    </style>
</head>
<body class="text-white safe-top">
    <!-- Header -->
    <header class="glass-card sticky top-0 z-40 px-4 sm:px-6 py-3 sm:py-4">
        <div class="max-w-7xl mx-auto flex items-center justify-between gap-2">
            <div class="flex items-center gap-2 sm:gap-3 flex-shrink-0">
                <div class="w-9 h-9 sm:w-10 sm:h-10 rounded-xl bg-gradient-to-br from-pink-500 to-orange-400 flex items-center justify-center">
                    <svg class="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                    </svg>
                </div>
                <h1 class="text-lg sm:text-xl font-bold bg-gradient-to-r from-pink-400 to-cyan-400 bg-clip-text text-transparent">
                    –ê—Ä—Ö–∏–≤ —Å–µ–º—å–∏ –ö—É–∏—Å
                </h1>
            </div>
            
            <div class="flex items-center gap-2 sm:gap-4">
                <!-- Mobile search toggle -->
                <button onclick="toggleMobileSearch()" class="sm:hidden touch-btn flex items-center justify-center p-2 rounded-full glass-card">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                    </svg>
                </button>
                
                <!-- Desktop search -->
                <div class="hidden sm:flex items-center gap-2 px-4 py-2 rounded-full glass-card">
                    <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                    </svg>
                    <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫..." class="bg-transparent outline-none text-sm w-40">
                </div>
                
                <button onclick="openUploadModal()" class="touch-btn flex items-center justify-center gap-2 px-3 sm:px-4 py-2 rounded-full bg-gradient-to-r from-pink-500 to-orange-400 hover:opacity-90 transition font-medium text-sm sm:text-base">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                    </svg>
                    <span class="hidden sm:inline">–î–æ–±–∞–≤–∏—Ç—å</span>
                </button>
            </div>
        </div>
        
        <!-- Mobile search bar -->
        <div id="mobileSearch" class="hidden sm:hidden mt-3">
            <div class="flex items-center gap-2 px-4 py-3 rounded-full glass-card">
                <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                </svg>
                <input type="text" id="mobileSearchInput" placeholder="–ü–æ–∏—Å–∫ —Ñ–æ—Ç–æ –∏ –≤–∏–¥–µ–æ..." class="bg-transparent outline-none text-sm flex-1">
                <button onclick="toggleMobileSearch()" class="text-gray-400">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <!-- Stats Bar -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 py-4 sm:py-6">
        <div class="grid grid-cols-4 gap-2 sm:gap-4">
            <div class="glass-card rounded-xl sm:rounded-2xl p-3 sm:p-4 text-center">
                <div class="text-xl sm:text-3xl font-bold text-pink-400" id="totalCount">0</div>
                <div class="text-xs sm:text-sm text-gray-400">–í—Å–µ–≥–æ</div>
            </div>
            <div class="glass-card rounded-xl sm:rounded-2xl p-3 sm:p-4 text-center">
                <div class="text-xl sm:text-3xl font-bold text-cyan-400" id="photoCount">0</div>
                <div class="text-xs sm:text-sm text-gray-400">–§–æ—Ç–æ</div>
            </div>
            <div class="glass-card rounded-xl sm:rounded-2xl p-3 sm:p-4 text-center">
                <div class="text-xl sm:text-3xl font-bold text-purple-400" id="videoCount">0</div>
                <div class="text-xs sm:text-sm text-gray-400">–í–∏–¥–µ–æ</div>
            </div>
            <div class="glass-card rounded-xl sm:rounded-2xl p-3 sm:p-4 text-center">
                <div class="text-xl sm:text-3xl font-bold text-orange-400" id="albumCount">0</div>
                <div class="text-xs sm:text-sm text-gray-400">–ê–ª—å–±–æ–º—ã</div>
            </div>
        </div>
    </div>

    <!-- Filters -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 pb-4 sm:pb-6">
        <div class="flex items-center gap-2 sm:gap-3">
            <!-- Scrollable filters on mobile -->
            <div class="flex items-center gap-2 overflow-x-auto filter-scroll flex-1 pb-1">
                <button onclick="filterMedia('all')" class="filter-btn active px-4 sm:px-5 py-2 rounded-full glass-card text-xs sm:text-sm font-medium transition whitespace-nowrap flex-shrink-0">
                    –í—Å–µ
                </button>
                <button onclick="filterMedia('photo')" class="filter-btn px-4 sm:px-5 py-2 rounded-full glass-card text-xs sm:text-sm font-medium transition hover:bg-white/10 whitespace-nowrap flex-shrink-0">
                    üì∑ –§–æ—Ç–æ
                </button>
                <button onclick="filterMedia('video')" class="filter-btn px-4 sm:px-5 py-2 rounded-full glass-card text-xs sm:text-sm font-medium transition hover:bg-white/10 whitespace-nowrap flex-shrink-0">
                    üé¨ –í–∏–¥–µ–æ
                </button>
                
                <select id="sortSelect" onchange="sortMedia()" class="px-3 sm:px-4 py-2 rounded-full glass-card text-xs sm:text-sm bg-transparent outline-none cursor-pointer flex-shrink-0">
                    <option value="newest" class="bg-gray-800">–ù–æ–≤—ã–µ</option>
                    <option value="oldest" class="bg-gray-800">–°—Ç–∞—Ä—ã–µ</option>
                    <option value="name" class="bg-gray-800">–ü–æ –∏–º–µ–Ω–∏</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Timeline View -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 pb-8 sm:pb-12 safe-bottom">
        <div id="mediaContainer" class="space-y-6 sm:space-y-10">
            <!-- Content will be injected here -->
        </div>
    </main>

    <!-- Upload Modal -->
    <div id="uploadModal" class="fixed inset-0 z-50 hidden items-end sm:items-center justify-center bg-black/70">
        <div class="glass-card mobile-sheet sm:rounded-3xl p-6 sm:p-8 w-full sm:max-w-lg animate-slide-up-modal sm:animate-slide-up sm:mx-4">
            <div class="flex items-center justify-between mb-4 sm:mb-6">
                <h2 class="text-xl sm:text-2xl font-bold">–î–æ–±–∞–≤–∏—Ç—å –º–µ–¥–∏–∞</h2>
                <button onclick="closeUploadModal()" class="touch-btn p-2 rounded-full hover:bg-white/10 transition">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            
            <div id="uploadZone" class="upload-zone rounded-2xl p-6 sm:p-10 text-center cursor-pointer mb-4 sm:mb-6">
                <svg class="w-12 h-12 sm:w-16 sm:h-16 mx-auto mb-3 sm:mb-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                </svg>
                <p class="text-gray-300 mb-1 sm:mb-2 text-sm sm:text-base">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–æ–≤</p>
                <p class="text-xs sm:text-sm text-gray-500">–∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Å—é–¥–∞</p>
                <input type="file" id="fileInput" accept="image/*,video/*" multiple class="hidden">
            </div>
            
            <div class="grid grid-cols-2 gap-3 sm:gap-4 mb-4 sm:mb-6">
                <div>
                    <label class="block text-xs sm:text-sm text-gray-400 mb-1 sm:mb-2">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                    <input type="text" id="mediaTitle" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ" class="w-full px-3 sm:px-4 py-2.5 sm:py-3 rounded-xl glass-card bg-transparent outline-none focus:ring-2 focus:ring-pink-500 transition text-sm">
                </div>
                <div>
                    <label class="block text-xs sm:text-sm text-gray-400 mb-1 sm:mb-2">–î–∞—Ç–∞</label>
                    <input type="date" id="mediaDate" class="w-full px-3 sm:px-4 py-2.5 sm:py-3 rounded-xl glass-card bg-transparent outline-none focus:ring-2 focus:ring-pink-500 transition text-sm">
                </div>
            </div>
            
            <div class="mb-4 sm:mb-6">
                <label class="block text-xs sm:text-sm text-gray-400 mb-1 sm:mb-2">–ê–ª—å–±–æ–º</label>
                <select id="mediaAlbum" class="w-full px-3 sm:px-4 py-2.5 sm:py-3 rounded-xl glass-card bg-transparent outline-none focus:ring-2 focus:ring-pink-500 transition text-sm">
                    <option value="vacation" class="bg-gray-800">üèñÔ∏è –û—Ç–ø—É—Å–∫</option>
                    <option value="family" class="bg-gray-800">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ –°–µ–º—å—è</option>
                    <option value="nature" class="bg-gray-800">üåø –ü—Ä–∏—Ä–æ–¥–∞</option>
                    <option value="events" class="bg-gray-800">üéâ –°–æ–±—ã—Ç–∏—è</option>
                    <option value="other" class="bg-gray-800">üìÅ –î—Ä—É–≥–æ–µ</option>
                </select>
            </div>
            
            <div class="flex gap-3">
                <button onclick="uploadFilesToGitHub()" class="flex-1 py-3 sm:py-4 rounded-xl bg-gradient-to-r from-pink-500 to-orange-400 font-semibold hover:opacity-90 transition text-sm sm:text-base">
                    üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤ GitHub
                </button>
                <button onclick="openTokenModal()" class="px-4 py-3 sm:py-4 rounded-xl glass-card hover:bg-white/10 transition" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–æ–∫–µ–Ω–∞">
                    üîë
                </button>
            </div>
            
            <div class="text-center mt-3">
                <button onclick="addDemoMedia()" class="text-gray-400 text-sm hover:text-white transition">
                    –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –¥–µ–º–æ –º–µ–¥–∏–∞
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 z-60 hidden items-center justify-center bg-black/80">
        <div class="text-center">
            <div class="w-16 h-16 border-4 border-pink-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
            <p class="text-white text-lg" id="loadingText">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
        </div>
    </div>

    <!-- Token Modal -->
    <div id="tokenModal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/70 p-4">
        <div class="glass-card rounded-3xl p-6 sm:p-8 w-full max-w-md animate-slide-up">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl sm:text-2xl font-bold">üîë GitHub –¢–æ–∫–µ–Ω</h2>
                <button onclick="closeTokenModal()" class="touch-btn p-2 rounded-full hover:bg-white/10 transition">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            
            <p class="text-gray-400 text-sm mb-4">
                –î–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ –≤ GitHub –Ω—É–∂–µ–Ω Personal Access Token —Å –ø—Ä–∞–≤–∞–º–∏ –Ω–∞ –∑–∞–ø–∏—Å—å –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.
            </p>
            
            <div class="mb-4">
                <label class="block text-sm text-gray-400 mb-2">Personal Access Token</label>
                <input type="password" id="githubToken" placeholder="ghp_xxxxxxxxxxxx" 
                       class="w-full px-4 py-3 rounded-xl glass-card bg-transparent outline-none focus:ring-2 focus:ring-pink-500 transition text-sm font-mono">
            </div>
            
            <div class="glass-card rounded-xl p-4 mb-6">
                <p class="text-xs text-gray-400 mb-2">üìå –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω:</p>
                <ol class="text-xs text-gray-500 space-y-1 list-decimal list-inside">
                    <li>–û—Ç–∫—Ä–æ–π—Ç–µ GitHub ‚Üí Settings ‚Üí Developer settings</li>
                    <li>Personal access tokens ‚Üí Tokens (classic)</li>
                    <li>Generate new token</li>
                    <li>–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∞–≤–∞: repo (–ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø)</li>
                </ol>
            </div>
            
            <div class="flex gap-3">
                <button onclick="closeTokenModal()" class="flex-1 py-3 rounded-xl glass-card hover:bg-white/10 transition font-medium">
                    –û—Ç–º–µ–Ω–∞
                </button>
                <button onclick="saveToken()" class="flex-1 py-3 rounded-xl bg-gradient-to-r from-pink-500 to-orange-400 font-semibold hover:opacity-90 transition">
                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                </button>
            </div>
        </div>
    </div>

    <!-- Media Viewer Modal -->
    <div id="viewerModal" class="fixed inset-0 z-50 hidden flex-col bg-black/95">
        <!-- Top bar -->
        <div class="flex items-center justify-between p-3 sm:p-4 safe-top">
            <div class="flex-1">
                <h3 id="viewerTitle" class="text-base sm:text-xl font-semibold truncate"></h3>
                <p id="viewerDate" class="text-xs sm:text-sm text-gray-400"></p>
            </div>
            <button onclick="closeViewer()" class="touch-btn p-2 sm:p-3 rounded-full glass-card hover:bg-white/20 transition ml-2">
                <svg class="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>
        
        <!-- Media content -->
        <div id="viewerContent" class="flex-1 flex items-center justify-center p-2 sm:p-4 overflow-hidden touch-pan-x"
             ontouchstart="handleTouchStart(event)" 
             ontouchmove="handleTouchMove(event)" 
             ontouchend="handleTouchEnd(event)">
            <!-- Media content -->
        </div>
        
        <!-- Bottom controls -->
        <div class="flex items-center justify-center gap-4 p-4 safe-bottom">
            <button onclick="prevMedia()" class="touch-btn p-3 sm:p-4 rounded-full glass-card hover:bg-white/20 transition">
                <svg class="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                </svg>
            </button>
            
            <div id="viewerCounter" class="text-sm text-gray-400 min-w-[60px] text-center"></div>
            
            <button onclick="nextMedia()" class="touch-btn p-3 sm:p-4 rounded-full glass-card hover:bg-white/20 transition">
                <svg class="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                </svg>
            </button>
        </div>
    </div>

    <script>
        // ============================================
        // –ù–ê–°–¢–†–û–ô–ö–ò GITHUB –†–ï–ü–û–ó–ò–¢–û–†–ò–Ø
        // ============================================
        const GITHUB_CONFIG = {
            owner: 'vadimkuis',
            repo: 'kuis-family-archive',
            branch: 'main',
            mediaFolder: 'media',
            dataFile: 'data/media.json',
            tokenFile: 'config/token.json',
            token: ''
        };
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–∫–µ–Ω–∞ –∏–∑ —Ñ–∞–π–ª–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
        async function loadToken() {
            // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º localStorage
            const savedToken = localStorage.getItem('github_token');
            if (savedToken) {
                GITHUB_CONFIG.token = savedToken;
                return savedToken;
            }
            
            // –ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ config/token.json
            try {
                const response = await fetch('config/token.json');
                if (response.ok) {
                    const data = await response.json();
                    if (data.github_token) {
                        GITHUB_CONFIG.token = data.github_token;
                        localStorage.setItem('github_token', data.github_token);
                        console.log('‚úÖ –¢–æ–∫–µ–Ω –∑–∞–≥—Ä—É–∂–µ–Ω –∏–∑ config/token.json');
                        return data.github_token;
                    }
                }
            } catch (e) {
                console.log('–õ–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª —Ç–æ–∫–µ–Ω–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–±—É–µ–º GitHub...');
            }
            
            // –ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
            try {
                const response = await fetch(`https://raw.githubusercontent.com/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/${GITHUB_CONFIG.branch}/${GITHUB_CONFIG.tokenFile}`);
                if (response.ok) {
                    const data = await response.json();
                    if (data.github_token) {
                        GITHUB_CONFIG.token = data.github_token;
                        localStorage.setItem('github_token', data.github_token);
                        console.log('‚úÖ –¢–æ–∫–µ–Ω –∑–∞–≥—Ä—É–∂–µ–Ω –∏–∑ GitHub');
                        return data.github_token;
                    }
                }
            } catch (e) {
                console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–æ–∫–µ–Ω –∏–∑ GitHub');
            }
            
            return null;
        }
        
        const GITHUB_BASE_URL = `https://raw.githubusercontent.com/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/${GITHUB_CONFIG.branch}/${GITHUB_CONFIG.mediaFolder}/`;
        const GITHUB_API_URL = `https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}`;
        
        // ============================================
        // –ú–ï–î–ò–ê –§–ê–ô–õ–´ –°–ï–ú–¨–ò –ö–£–ò–°
        // ============================================
        let mediaItems = [];
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ GitHub
        async function loadMediaFromGitHub() {
            try {
                showLoading(true);
                const response = await fetch(`${GITHUB_API_URL}/contents/${GITHUB_CONFIG.dataFile}`, {
                    headers: GITHUB_CONFIG.token ? { 'Authorization': `token ${GITHUB_CONFIG.token}` } : {}
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const content = JSON.parse(atob(data.content));
                    mediaItems = content.map(item => ({
                        ...item,
                        url: GITHUB_BASE_URL + item.file,
                        thumbnail: item.thumbnail ? GITHUB_BASE_URL + item.thumbnail : undefined
                    }));
                } else if (response.status === 404) {
                    // –§–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —Å–æ–∑–¥–∞–µ–º –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤
                    mediaItems = [];
                    console.log('–§–∞–π–ª –¥–∞–Ω–Ω—ã—Ö –Ω–µ –Ω–∞–π–¥–µ–Ω, –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ');
                } else {
                    throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–º–æ –¥–∞–Ω–Ω—ã–µ –µ—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å
                mediaItems = getDemoData();
            } finally {
                showLoading(false);
                renderMedia();
                updateStats();
            }
        }
        
        function getDemoData() {
            return [
                { id: 1, type: 'photo', title: '–î–µ–º–æ —Ñ–æ—Ç–æ 1', date: '2024-01-15', album: 'family', url: 'https://images.unsplash.com/photo-1511895426328-dc8714191300?w=800' },
                { id: 2, type: 'photo', title: '–î–µ–º–æ —Ñ–æ—Ç–æ 2', date: '2024-01-10', album: 'vacation', url: 'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=800' },
            ];
        }
        
        function showLoading(show) {
            const loader = document.getElementById('loadingOverlay');
            if (show) {
                loader.classList.remove('hidden');
                loader.classList.add('flex');
            } else {
                loader.classList.add('hidden');
                loader.classList.remove('flex');
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –≤ GitHub
        async function uploadToGitHub(file, fileName) {
            if (!GITHUB_CONFIG.token) {
                openTokenModal();
                throw new Error('–¢—Ä–µ–±—É–µ—Ç—Å—è GitHub —Ç–æ–∫–µ–Ω');
            }
            
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = async () => {
                    try {
                        const base64Content = reader.result.split(',')[1];
                        const filePath = `${GITHUB_CONFIG.mediaFolder}/${fileName}`;
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Ñ–∞–π–ª
                        let sha = null;
                        try {
                            const existingFile = await fetch(`${GITHUB_API_URL}/contents/${filePath}`, {
                                headers: { 'Authorization': `token ${GITHUB_CONFIG.token}` }
                            });
                            if (existingFile.ok) {
                                const data = await existingFile.json();
                                sha = data.sha;
                            }
                        } catch (e) {}
                        
                        const body = {
                            message: `–î–æ–±–∞–≤–ª–µ–Ω–æ: ${fileName}`,
                            content: base64Content,
                            branch: GITHUB_CONFIG.branch
                        };
                        if (sha) body.sha = sha;
                        
                        const response = await fetch(`${GITHUB_API_URL}/contents/${filePath}`, {
                            method: 'PUT',
                            headers: {
                                'Authorization': `token ${GITHUB_CONFIG.token}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(body)
                        });
                        
                        if (!response.ok) {
                            const error = await response.json();
                            throw new Error(error.message || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞');
                        }
                        
                        resolve(await response.json());
                    } catch (error) {
                        reject(error);
                    }
                };
                reader.onerror = () => reject(new Error('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞'));
                reader.readAsDataURL(file);
            });
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –≤ GitHub
        async function saveMediaData() {
            if (!GITHUB_CONFIG.token) {
                throw new Error('–¢—Ä–µ–±—É–µ—Ç—Å—è GitHub —Ç–æ–∫–µ–Ω');
            }
            
            const dataToSave = mediaItems.map(({ id, type, title, date, album, file, thumbnail }) => ({
                id, type, title, date, album, file, thumbnail
            }));
            
            const content = btoa(unescape(encodeURIComponent(JSON.stringify(dataToSave, null, 2))));
            const filePath = GITHUB_CONFIG.dataFile;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Ñ–∞–π–ª
            let sha = null;
            try {
                const existingFile = await fetch(`${GITHUB_API_URL}/contents/${filePath}`, {
                    headers: { 'Authorization': `token ${GITHUB_CONFIG.token}` }
                });
                if (existingFile.ok) {
                    const data = await existingFile.json();
                    sha = data.sha;
                }
            } catch (e) {}
            
            const body = {
                message: '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –º–µ–¥–∏–∞—Ç–µ–∫–∏',
                content: content,
                branch: GITHUB_CONFIG.branch
            };
            if (sha) body.sha = sha;
            
            const response = await fetch(`${GITHUB_API_URL}/contents/${filePath}`, {
                method: 'PUT',
                headers: {
                    'Authorization': `token ${GITHUB_CONFIG.token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(body)
            });
            
            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.message || '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö');
            }
            
            return await response.json();
        }
        
        // –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –∏–∑ GitHub
        async function deleteFromGitHub(fileName) {
            if (!GITHUB_CONFIG.token) {
                openTokenModal();
                throw new Error('–¢—Ä–µ–±—É–µ—Ç—Å—è GitHub —Ç–æ–∫–µ–Ω');
            }
            
            const filePath = `${GITHUB_CONFIG.mediaFolder}/${fileName}`;
            
            // –ü–æ–ª—É—á–∞–µ–º SHA —Ñ–∞–π–ª–∞
            const existingFile = await fetch(`${GITHUB_API_URL}/contents/${filePath}`, {
                headers: { 'Authorization': `token ${GITHUB_CONFIG.token}` }
            });
            
            if (!existingFile.ok) {
                throw new Error('–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω');
            }
            
            const data = await existingFile.json();
            
            const response = await fetch(`${GITHUB_API_URL}/contents/${filePath}`, {
                method: 'DELETE',
                headers: {
                    'Authorization': `token ${GITHUB_CONFIG.token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    message: `–£–¥–∞–ª–µ–Ω–æ: ${fileName}`,
                    sha: data.sha,
                    branch: GITHUB_CONFIG.branch
                })
            });
            
            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.message || '–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞');
            }
            
            return true;
        }

        let currentFilter = 'all';
        let currentView = 'grid';
        let currentIndex = 0;
        let filteredItems = [];
        
        // Touch swipe handling
        let touchStartX = 0;
        let touchEndX = 0;
        let touchStartY = 0;
        let touchEndY = 0;

        // Initialize
        document.addEventListener('DOMContentLoaded', async () => {
            // –°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–∫–µ–Ω
            await loadToken();
            
            // –ó–∞—Ç–µ–º –∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ GitHub
            loadMediaFromGitHub();
            setupUploadZone();
            
            document.getElementById('mediaDate').valueAsDate = new Date();
            
            document.getElementById('searchInput')?.addEventListener('input', (e) => {
                renderMedia(e.target.value);
            });
            
            document.getElementById('mobileSearchInput')?.addEventListener('input', (e) => {
                renderMedia(e.target.value);
            });
        });
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –≤ GitHub
        async function uploadFilesToGitHub() {
            if (selectedFiles.length === 0) {
                showNotification('‚ùå –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª—ã –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏', 'error');
                return;
            }
            
            if (!GITHUB_CONFIG.token) {
                openTokenModal();
                return;
            }
            
            const title = document.getElementById('mediaTitle').value;
            const date = document.getElementById('mediaDate').value || new Date().toISOString().split('T')[0];
            const album = document.getElementById('mediaAlbum').value;
            
            showLoading(true);
            document.getElementById('loadingText').textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤...';
            
            try {
                for (let i = 0; i < selectedFiles.length; i++) {
                    const file = selectedFiles[i];
                    document.getElementById('loadingText').textContent = `–ó–∞–≥—Ä—É–∑–∫–∞ ${i + 1}/${selectedFiles.length}: ${file.name}`;
                    
                    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è —Ñ–∞–π–ª–∞
                    const timestamp = Date.now();
                    const ext = file.name.split('.').pop();
                    const safeName = file.name.replace(/[^a-zA-Z0-9.-]/g, '_');
                    const fileName = `${timestamp}_${safeName}`;
                    
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∞–π–ª
                    await uploadToGitHub(file, fileName);
                    
                    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø
                    const type = file.type.startsWith('video/') ? 'video' : 'photo';
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –≤ –º–∞—Å—Å–∏–≤
                    const itemTitle = selectedFiles.length === 1 ? title || file.name.replace(/\.[^/.]+$/, '') : 
                                     `${title || '–ú–µ–¥–∏–∞'} (${i + 1})`;
                    
                    mediaItems.unshift({
                        id: timestamp + i,
                        type: type,
                        title: itemTitle,
                        date: date,
                        album: album,
                        file: fileName,
                        url: GITHUB_BASE_URL + fileName
                    });
                }
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                document.getElementById('loadingText').textContent = '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...';
                await saveMediaData();
                
                showNotification(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ñ–∞–π–ª–æ–≤: ${selectedFiles.length}`);
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É
                selectedFiles = [];
                document.getElementById('mediaTitle').value = '';
                resetUploadZone();
                
                renderMedia();
                updateStats();
                closeUploadModal();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
                showNotification(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            } finally {
                showLoading(false);
            }
        }
        
        function resetUploadZone() {
            const zone = document.getElementById('uploadZone');
            zone.innerHTML = `
                <svg class="w-12 h-12 sm:w-16 sm:h-16 mx-auto mb-3 sm:mb-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                </svg>
                <p class="text-gray-300 mb-1 sm:mb-2 text-sm sm:text-base">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–æ–≤</p>
                <p class="text-xs sm:text-sm text-gray-500">–∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Å—é–¥–∞</p>
                <input type="file" id="fileInput" accept="image/*,video/*" multiple class="hidden">
            `;
            setupUploadZone();
        }

        function toggleMobileSearch() {
            const searchBar = document.getElementById('mobileSearch');
            const input = document.getElementById('mobileSearchInput');
            
            if (searchBar.classList.contains('hidden')) {
                searchBar.classList.remove('hidden');
                input.focus();
            } else {
                searchBar.classList.add('hidden');
                input.value = '';
                renderMedia();
            }
        }

        function setupUploadZone() {
            const zone = document.getElementById('uploadZone');
            const input = document.getElementById('fileInput');
            
            zone.addEventListener('click', () => input.click());
            
            zone.addEventListener('dragover', (e) => {
                e.preventDefault();
                zone.classList.add('dragover');
            });
            
            zone.addEventListener('dragleave', () => {
                zone.classList.remove('dragover');
            });
            
            zone.addEventListener('drop', (e) => {
                e.preventDefault();
                zone.classList.remove('dragover');
                handleFiles(e.dataTransfer.files);
            });
            
            input.addEventListener('change', (e) => {
                handleFiles(e.target.files);
            });
        }

        // –í—ã–±—Ä–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
        let selectedFiles = [];
        
        function handleFiles(files) {
            selectedFiles = Array.from(files);
            if (selectedFiles.length > 0) {
                const zone = document.getElementById('uploadZone');
                zone.innerHTML = `
                    <div class="text-green-400 mb-2">
                        <svg class="w-12 h-12 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                        </svg>
                    </div>
                    <p class="text-white font-medium">–í—ã–±—Ä–∞–Ω–æ —Ñ–∞–π–ª–æ–≤: ${selectedFiles.length}</p>
                    <p class="text-gray-400 text-sm mt-1">${selectedFiles.map(f => f.name).join(', ')}</p>
                    <input type="file" id="fileInput" accept="image/*,video/*" multiple class="hidden">
                `;
                // –ó–∞–ø–æ–ª–Ω—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–µ—Ä–≤—ã–º —Ñ–∞–π–ª–æ–º
                if (!document.getElementById('mediaTitle').value) {
                    const firstName = selectedFiles[0].name.replace(/\.[^/.]+$/, '').replace(/[_-]/g, ' ');
                    document.getElementById('mediaTitle').value = firstName;
                }
            }
        }
        
        // Token Modal functions
        function openTokenModal() {
            document.getElementById('tokenModal').classList.remove('hidden');
            document.getElementById('tokenModal').classList.add('flex');
            document.getElementById('githubToken').value = GITHUB_CONFIG.token;
        }
        
        function closeTokenModal() {
            document.getElementById('tokenModal').classList.add('hidden');
            document.getElementById('tokenModal').classList.remove('flex');
        }
        
        function saveToken() {
            const token = document.getElementById('githubToken').value.trim();
            if (token) {
                GITHUB_CONFIG.token = token;
                localStorage.setItem('github_token', token);
                closeTokenModal();
                showNotification('‚úÖ –¢–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω!');
            } else {
                showNotification('‚ùå –í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω', 'error');
            }
        }
        
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `fixed top-20 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-xl z-50 ${
                type === 'error' ? 'bg-red-500' : 'bg-green-500'
            } text-white font-medium shadow-lg animate-slide-up`;
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 3000);
        }

        function renderMedia(searchQuery = '') {
            const container = document.getElementById('mediaContainer');
            let items = [...mediaItems];
            
            // Filter
            if (currentFilter !== 'all') {
                items = items.filter(item => item.type === currentFilter);
            }
            
            // Search
            if (searchQuery) {
                items = items.filter(item => 
                    item.title.toLowerCase().includes(searchQuery.toLowerCase())
                );
            }
            
            // Sort
            const sortType = document.getElementById('sortSelect').value;
            items.sort((a, b) => {
                if (sortType === 'newest') return new Date(b.date) - new Date(a.date);
                if (sortType === 'oldest') return new Date(a.date) - new Date(b.date);
                return a.title.localeCompare(b.title);
            });
            
            // Store filtered items for navigation
            filteredItems = items;
            
            // Group by date
            const grouped = items.reduce((acc, item) => {
                const date = formatDate(item.date);
                if (!acc[date]) acc[date] = [];
                acc[date].push(item);
                return acc;
            }, {});
            
            // Render
            container.innerHTML = Object.entries(grouped).map(([date, items], groupIndex) => `
                <div class="animate-slide-up" style="animation-delay: ${groupIndex * 0.1}s">
                    <div class="flex items-center gap-3 sm:gap-4 mb-4 sm:mb-6">
                        <div class="date-badge px-3 sm:px-4 py-1.5 sm:py-2 rounded-full text-xs sm:text-sm font-medium">
                            ${date}
                        </div>
                        <div class="flex-1 h-px bg-gradient-to-r from-pink-500/50 to-transparent"></div>
                        <span class="text-gray-400 text-xs sm:text-sm">${items.length}</span>
                    </div>
                    <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-2 sm:gap-4">
                        ${items.map((item, index) => renderMediaCard(item, index)).join('')}
                    </div>
                </div>
            `).join('');
            
            if (Object.keys(grouped).length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12 sm:py-20">
                        <svg class="w-16 h-16 sm:w-24 sm:h-24 mx-auto mb-4 sm:mb-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        <h3 class="text-lg sm:text-xl font-semibold text-gray-400 mb-2">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
                        <p class="text-sm text-gray-500">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</p>
                    </div>
                `;
            }
        }

        function renderMediaCard(item, index) {
            const albumEmoji = {
                'vacation': 'üèñÔ∏è',
                'family': 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶',
                'nature': 'üåø',
                'events': 'üéâ',
                'other': 'üìÅ'
            };
            
            return `
                <div class="media-card glass-card rounded-xl sm:rounded-2xl overflow-hidden cursor-pointer relative group" 
                     onclick="openViewer(${item.id})"
                     style="animation-delay: ${index * 0.05}s">
                    <div class="aspect-square overflow-hidden">
                        ${item.type === 'video' 
                            ? `<img src="${item.thumbnail}" alt="${item.title}" class="w-full h-full object-cover transition duration-500" loading="lazy">`
                            : `<img src="${item.url}" alt="${item.title}" class="w-full h-full object-cover transition duration-500" loading="lazy">`
                        }
                    </div>
                    
                    ${item.type === 'video' ? `
                        <div class="absolute top-2 sm:top-3 right-2 sm:right-3 video-indicator w-8 h-8 sm:w-10 sm:h-10 rounded-full flex items-center justify-center">
                            <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M8 5v14l11-7z"/>
                            </svg>
                        </div>
                    ` : ''}
                    
                    <div class="absolute top-2 sm:top-3 left-2 sm:left-3 text-sm sm:text-lg">${albumEmoji[item.album] || 'üìÅ'}</div>
                    
                    <div class="overlay absolute inset-0 flex flex-col justify-end p-2 sm:p-4">
                        <h3 class="font-medium sm:font-semibold text-sm sm:text-lg truncate">${item.title}</h3>
                        <p class="text-xs sm:text-sm text-gray-300">${formatDateShort(item.date)}</p>
                    </div>
                </div>
            `;
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            const options = { day: 'numeric', month: 'long', year: 'numeric' };
            return date.toLocaleDateString('ru-RU', options);
        }

        function formatDateShort(dateStr) {
            const date = new Date(dateStr);
            const options = { day: 'numeric', month: 'short' };
            return date.toLocaleDateString('ru-RU', options);
        }

        function updateStats() {
            document.getElementById('totalCount').textContent = mediaItems.length;
            document.getElementById('photoCount').textContent = mediaItems.filter(i => i.type === 'photo').length;
            document.getElementById('videoCount').textContent = mediaItems.filter(i => i.type === 'video').length;
            document.getElementById('albumCount').textContent = [...new Set(mediaItems.map(i => i.album))].length;
        }

        function filterMedia(type) {
            currentFilter = type;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            const searchQuery = document.getElementById('mobileSearchInput')?.value || document.getElementById('searchInput')?.value || '';
            renderMedia(searchQuery);
        }

        function sortMedia() {
            const searchQuery = document.getElementById('mobileSearchInput')?.value || document.getElementById('searchInput')?.value || '';
            renderMedia(searchQuery);
        }

        function openUploadModal() {
            document.getElementById('uploadModal').classList.remove('hidden');
            document.getElementById('uploadModal').classList.add('flex');
            document.body.style.overflow = 'hidden';
        }

        function closeUploadModal() {
            document.getElementById('uploadModal').classList.add('hidden');
            document.getElementById('uploadModal').classList.remove('flex');
            document.body.style.overflow = '';
        }

        function addDemoMedia() {
            const demoPhotos = [
                { title: '–û—Å–µ–Ω–Ω–∏–π –ø–∞—Ä–∫', url: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=800', album: 'nature' },
                { title: '–ö–æ—Ñ–µ –∏ –∫–Ω–∏–≥–∞', url: 'https://images.unsplash.com/photo-1456513080510-7bf3a84b82f8?w=800', album: 'other' },
                { title: '–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ', url: 'https://images.unsplash.com/photo-1469854523086-cc02fe5d8800?w=800', album: 'vacation' },
                { title: '–í—Å—Ç—Ä–µ—á–∞ –¥—Ä—É–∑–µ–π', url: 'https://images.unsplash.com/photo-1529156069898-49953e39b3ac?w=800', album: 'events' },
            ];
            
            const random = demoPhotos[Math.floor(Math.random() * demoPhotos.length)];
            const title = document.getElementById('mediaTitle').value || random.title;
            const date = document.getElementById('mediaDate').value || new Date().toISOString().split('T')[0];
            const album = document.getElementById('mediaAlbum').value;
            
            const newItem = {
                id: Date.now(),
                type: 'photo',
                title: title,
                date: date,
                album: album,
                url: random.url
            };
            
            mediaItems.unshift(newItem);
            renderMedia();
            updateStats();
            closeUploadModal();
            
            document.getElementById('mediaTitle').value = '';
        }

        function openViewer(id) {
            const itemIndex = filteredItems.findIndex(m => m.id === id);
            if (itemIndex === -1) return;
            
            currentIndex = itemIndex;
            updateViewer(filteredItems[currentIndex]);
            
            document.getElementById('viewerModal').classList.remove('hidden');
            document.getElementById('viewerModal').classList.add('flex');
            document.body.style.overflow = 'hidden';
        }

        function updateViewer(item) {
            const content = document.getElementById('viewerContent');
            
            if (item.type === 'video') {
                content.innerHTML = `
                    <video controls autoplay playsinline class="max-h-full max-w-full rounded-xl sm:rounded-2xl shadow-2xl">
                        <source src="${item.url}" type="video/mp4">
                    </video>
                `;
            } else {
                content.innerHTML = `
                    <img src="${item.url}" alt="${item.title}" class="max-h-full max-w-full rounded-xl sm:rounded-2xl shadow-2xl object-contain">
                `;
            }
            
            document.getElementById('viewerTitle').textContent = item.title;
            document.getElementById('viewerDate').textContent = formatDate(item.date);
            document.getElementById('viewerCounter').textContent = `${currentIndex + 1} / ${filteredItems.length}`;
        }

        function closeViewer() {
            document.getElementById('viewerModal').classList.add('hidden');
            document.getElementById('viewerModal').classList.remove('flex');
            document.body.style.overflow = '';
            
            const video = document.querySelector('#viewerContent video');
            if (video) video.pause();
        }

        function prevMedia() {
            currentIndex = (currentIndex - 1 + filteredItems.length) % filteredItems.length;
            updateViewer(filteredItems[currentIndex]);
        }

        function nextMedia() {
            currentIndex = (currentIndex + 1) % filteredItems.length;
            updateViewer(filteredItems[currentIndex]);
        }

        // Touch swipe handlers
        function handleTouchStart(e) {
            touchStartX = e.changedTouches[0].screenX;
            touchStartY = e.changedTouches[0].screenY;
        }

        function handleTouchMove(e) {
            touchEndX = e.changedTouches[0].screenX;
            touchEndY = e.changedTouches[0].screenY;
        }

        function handleTouchEnd(e) {
            const diffX = touchStartX - touchEndX;
            const diffY = touchStartY - touchEndY;
            
            // Only handle horizontal swipes
            if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
                if (diffX > 0) {
                    nextMedia();
                } else {
                    prevMedia();
                }
            }
        }

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            const viewerVisible = !document.getElementById('viewerModal').classList.contains('hidden');
            
            if (viewerVisible) {
                if (e.key === 'Escape') closeViewer();
                if (e.key === 'ArrowLeft') prevMedia();
                if (e.key === 'ArrowRight') nextMedia();
            }
            
            if (e.key === 'Escape') {
                closeUploadModal();
            }
        });

        // Close modals on back button
        window.addEventListener('popstate', () => {
            if (!document.getElementById('viewerModal').classList.contains('hidden')) {
                closeViewer();
            }
            if (!document.getElementById('uploadModal').classList.contains('hidden')) {
                closeUploadModal();
            }
        });
    </script>
</body>
</html>